<mxfile host="app.diagrams.net">
  <diagram name="RAG Retrieval and Generation Flow">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1"
                  tooltips="1" connect="1" arrows="1" fold="1"
                  page="1" pageScale="1" pageWidth="827" pageHeight="1169">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- User Query -->
        <mxCell id="user" value="User Query / Alert&#10;&quot;How to detect brute force attack?&quot;"
                style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;"
                vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="300" height="70" as="geometry"/>
        </mxCell>

        <!-- Embedding -->
        <mxCell id="embed" value="Embedding Model&#10;all-MiniLM-L6-v2&#10;384 dimensions"
                style="rounded=1;whiteSpace=wrap;html=1;"
                vertex="1" parent="1">
          <mxGeometry x="230" y="120" width="360" height="80" as="geometry"/>
        </mxCell>

        <!-- Query Vector -->
        <mxCell id="vector" value="Query Vector&#10;[0.12, -0.45, 0.78, ...]"
                style="rounded=1;whiteSpace=wrap;html=1;dashed=1;"
                vertex="1" parent="1">
          <mxGeometry x="260" y="230" width="300" height="60" as="geometry"/>
        </mxCell>

        <!-- ChromaDB -->
        <mxCell id="chroma" value="ChromaDB Vector Store&#10;Similarity Search (Cosine)&#10;&#10;Doc1 → 0.95&#10;Doc2 → 0.89&#10;Doc3 → 0.87"
                style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;"
                vertex="1" parent="1">
          <mxGeometry x="200" y="320" width="420" height="140" as="geometry"/>
        </mxCell>

        <!-- Top K -->
        <mxCell id="topk" value="Top-K Documents (k=3)"
                style="rounded=1;whiteSpace=wrap;html=1;dashed=1;"
                vertex="1" parent="1">
          <mxGeometry x="260" y="490" width="300" height="50" as="geometry"/>
        </mxCell>

        <!-- Context Assembly -->
        <mxCell id="context" value="Context Assembly (RAG Context)&#10;&#10;Reference 1: brute_force_detection.md&#10;Reference 2: MITRE ATT&amp;CK T1110"
                style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;"
                vertex="1" parent="1">
          <mxGeometry x="180" y="570" width="460" height="120" as="geometry"/>
        </mxCell>

        <!-- LLM -->
        <mxCell id="llm" value="LLM (Qwen3:8b via Ollama)&#10;&#10;System Prompt + RAG Context + Query&#10;↓&#10;Generate Response"
                style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;"
                vertex="1" parent="1">
          <mxGeometry x="200" y="720" width="420" height="120" as="geometry"/>
        </mxCell>

        <!-- AI Response -->
        <mxCell id="resp" value="AI Response (Context-aware)&#10;&#10;Detect brute force using&#10;Windows Event ID 4625..."
                style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;"
                vertex="1" parent="1">
          <mxGeometry x="230" y="870" width="360" height="100" as="geometry"/>
        </mxCell>

        <!-- Edges -->
        <mxCell id="e1" edge="1" parent="1" source="user" target="embed">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e2" edge="1" parent="1" source="embed" target="vector">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e3" edge="1" parent="1" source="vector" target="chroma">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e4" edge="1" parent="1" source="chroma" target="topk">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e5" edge="1" parent="1" source="topk" target="context">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e6" edge="1" parent="1" source="context" target="llm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e7" edge="1" parent="1" source="llm" target="resp">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
